<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DI è—¥å¸«è¡›æ•™å–®å¼µè‡ªå‹•åŒ–å·¥å…· (å« PDF è§£æ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // è¨­å®š PDF.js Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f3f4f6; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 2s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-6">

<div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8">
    <h1 class="text-2xl font-bold text-blue-700 mb-2">ğŸ¥ è—¥å“è¡›æ•™å–®å¼µ Prompt ç”Ÿæˆå™¨</h1>
    <p class="text-gray-600 mb-6 text-sm">æ”¯æ´ä¸Šå‚³ PDF (UpToDate/Micromedex) æˆ–ç›´æ¥è²¼ä¸Šæ–‡å­—ï¼Œä¸€éµç”Ÿæˆ AI æŒ‡ä»¤ã€‚</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label class="block text-sm font-medium text-gray-700">æŒ‡å®šå­¸å (Generic Name)</label>
            <input type="text" id="genericName" placeholder="ä¾‹å¦‚ï¼šAmiodarone HCl" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2" value="Amiodarone HCl">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700">æŒ‡å®šå•†å“å (Brand Name)</label>
            <input type="text" id="brandName" placeholder="ä¾‹å¦‚ï¼šCordarone Tab 200 mg" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2" value="Cordarone Tab 200 mg">
        </div>
    </div>

    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">è—¥å“å»¢æ£„é¡åˆ¥</label>
        <select id="drugCategory" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 bg-gray-50">
            <option value="general">ä¸€èˆ¬è—¥å“ (ä½¿ç”¨ H-1 éš¨åƒåœ¾ä¸Ÿæ£„)</option>
            <option value="special">ç‰¹æ®Šè—¥å“ (ä½¿ç”¨ H-2 éœ€æª¢æ”¶ï¼šæŠ—ç”Ÿç´ /è·çˆ¾è’™/æŠ—ç™Œè—¥/ç®¡åˆ¶è—¥)</option>
        </select>
    </div>

    <div class="mb-2 p-4 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50 hover:bg-blue-100 transition">
        <label class="block text-sm font-bold text-blue-800 mb-2 cursor-pointer">
            ğŸ“„ é»æ“Šä¸Šå‚³ PDF æª”æ¡ˆ (UpToDate/Micromedex)
            <input type="file" id="pdfInput" accept=".pdf" class="hidden" onchange="handlePdfUpload(this)">
        </label>
        <p id="uploadStatus" class="text-xs text-gray-500">æ”¯æ´ PDF æ ¼å¼ï¼Œè§£æå°‡ç”±ç€è¦½å™¨æœ¬æ©ŸåŸ·è¡Œã€‚</p>
    </div>

    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">åŸå§‹æ–‡ç»å…§å®¹ (Source Content)</label>
        <textarea id="sourceText" rows="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 text-sm" placeholder="ä¸Šå‚³ PDF å¾Œï¼Œæ–‡å­—æœƒè‡ªå‹•å‡ºç¾åœ¨é€™è£¡... ç•¶ç„¶æ‚¨ä¹Ÿå¯ä»¥æ‰‹å‹•è²¼ä¸Šã€‚"></textarea>
    </div>

    <button onclick="generateAndCopy()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition duration-200 shadow-md">
        ç”Ÿæˆ Prompt ä¸¦è¤‡è£½åˆ°å‰ªè²¼ç°¿ ğŸ“‹
    </button>

    <div class="mt-6 border-t pt-4">
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Prompt é è¦½</h3>
        <pre id="outputPreview" class="bg-gray-800 text-green-400 p-4 rounded text-xs overflow-auto h-64 whitespace-pre-wrap">å°šæœªç”Ÿæˆ...</pre>
    </div>
</div>

<script>
    // --- PDF è§£æåŠŸèƒ½ ---
    async function handlePdfUpload(input) {
        const file = input.files[0];
        if (!file) return;

        const statusElem = document.getElementById('uploadStatus');
        const textArea = document.getElementById('sourceText');
        
        if (file.type !== 'application/pdf') {
            alert('è«‹ä¸Šå‚³ PDF æª”æ¡ˆæ ¼å¼');
            return;
        }

        try {
            statusElem.innerHTML = '<span class="loader"></span>æ­£åœ¨è®€å– PDF å…§å®¹ï¼Œè«‹ç¨å€™...';
            
            // è®€å–æª”æ¡ˆç‚º ArrayBuffer
            const arrayBuffer = await file.arrayBuffer();
            
            // è¼‰å…¥ PDF
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = "";

            // é€é è®€å–
            for (let i = 1; i <= pdf.numPages; i++) {
                statusElem.innerHTML = `<span class="loader"></span>æ­£åœ¨è§£æç¬¬ ${i} / ${pdf.numPages} é ...`;
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                
                // å°‡è©²é çš„æ–‡å­—ç‰‡æ®µçµ„åˆæˆå­—ä¸²
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += `--- PAGE ${i} ---\n${pageText}\n\n`;
            }

            // å¡«å…¥ TextArea
            textArea.value = fullText;
            statusElem.innerHTML = `âœ… æˆåŠŸè§£æï¼š${file.name} (å…± ${pdf.numPages} é )`;
            statusElem.className = "text-xs text-green-600 font-bold";

        } catch (error) {
            console.error(error);
            statusElem.innerHTML = `âŒ è§£æå¤±æ•—ï¼š${error.message}`;
            statusElem.className = "text-xs text-red-600 font-bold";
            alert("PDF è§£æç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦ææ¯€æˆ–åŠ å¯†ã€‚");
        }
    }

    // --- Prompt ç”ŸæˆåŠŸèƒ½ (ç¶­æŒä¸è®Š) ---
    function generateAndCopy() {
        const generic = document.getElementById('genericName').value;
        const brand = document.getElementById('brandName').value;
        const category = document.getElementById('drugCategory').value;
        const source = document.getElementById('sourceText').value;

        if (!source.trim()) {
            alert("è«‹å…ˆä¸Šå‚³ PDF æˆ–è²¼ä¸ŠåŸå§‹æ–‡ç»å…§å®¹ï¼");
            return;
        }

        let disposalInstruction = "";
        if (category === "general") {
            disposalInstruction = `ã€å›ºå®šèªå¥ H-1 (ä¸€èˆ¬è—¥å“)ã€‘
æœ¬è—¥ç‚ºã€Œä¸€èˆ¬è—¥å“ã€ï¼Œç›®å‰åœ‹å…§å¤šç‚ºé«˜æº«ç„šåŒ–çˆï¼Œç‡ƒç‡’å¾Œå‡å¯å°‡è—¥å“å®Œå…¨è™•ç†ä¸¦æ¸›å°‘äºŒæ¬¡ç’°å¢ƒæ±™æŸ“ï¼Œä¾è¡›ç”Ÿä¸»ç®¡æ©Ÿé—œå»ºè­°ï¸°è«‹å°‡è£¸è—¥æ”¾å…¥å¤¾éŠè¢‹æˆ–å¯å°å£çš„å¡‘è† è¢‹ï¼ŒåŒå®¶ä¸­åƒåœ¾éš¨åƒåœ¾è»Šä¸Ÿæ£„ï¼›å¤–åŒ…è£å‰‡ä¾å›æ”¶åˆ†é¡è™•ç†ã€‚`;
        } else {
            disposalInstruction = `ã€å›ºå®šèªå¥ H-2 (ç‰¹æ®Šè—¥å“)ã€‘
æœ¬è—¥å±¬æ–¼ç‰¹æ®Šè—¥å“ï¼ˆå¦‚æŠ—ç”Ÿç´ ã€è·çˆ¾è’™ã€æŠ—ç™Œè—¥ã€ç®¡åˆ¶è—¥ç­‰ï¼‰ï¼Œè«‹å‹¿éš¨æ„ä¸Ÿæ£„ã€‚è«‹å°‡å‰©é¤˜è—¥å“æ‹¿å›åŸé†«ç™‚é™¢æ‰€è—¥å±€æˆ–ç¤¾å€è—¥å±€é€²è¡Œæª¢æ”¶èˆ‡å›æ”¶è™•ç†ã€‚`;
        }

        const prompt = `
# Role
ä½ æ˜¯ä¸€ä½å°ç£çš„å°ˆæ¥­è—¥ç‰©è³‡è¨Šï¼ˆDrug Information, DIï¼‰è—¥å¸«ã€‚ä½ çš„ä»»å‹™æ˜¯é–±è®€ä¸‹æ–¹çš„ã€Input Dataã€‘ï¼Œä¸¦ä¾ç…§ã€Strict Constraintsã€‘èˆ‡ã€Output Templateã€‘è£½ä½œä¸€ä»½ç¹é«”ä¸­æ–‡è—¥å“è¡›æ•™å–®å¼µã€‚

# Input Data
1. **æŒ‡å®šå­¸å**ï¼š${generic}
2. **æŒ‡å®šå•†å“å**ï¼š${brand}
3. **ä¾†æºæ–‡ä»¶**ï¼š
"""
${source}
"""

# Strict Constraints (åš´æ ¼è¦ç¯„)
1. **èªè¨€**ï¼šç¹é«”ä¸­æ–‡ï¼ˆå°ç£é†«ç™‚ç”¨èªï¼Œå¦‚ï¼šéµé†«å›‘ã€å›è¨ºï¼‰ã€‚
2. **æ ¼å¼**ï¼šåš´æ ¼éµå®ˆä¸‹æ–¹æ¨¡æ¿çµæ§‹ï¼Œä¿ç•™æ‰€æœ‰ã€å›ºå®šèªå¥ã€‘ã€‚
3. **å…§å®¹éæ¿¾**ï¼š
   - æª¢æŸ¥åŸæ–‡æ˜¯å¦æåŠ "Regular blood tests", "Liver function", "Thyroid", "Eye exam"ã€‚è‹¥æœ‰ï¼Œå¿…é ˆè¼¸å‡ºã€å›ºå®šèªå¥ Cã€‘æ®µè½ï¼›è‹¥ç„¡å‰‡åˆªé™¤è©²æ®µã€‚
   - æª¢æŸ¥åŸæ–‡æ˜¯å¦æåŠ "Dizziness", "Drowsiness", "Visual disturbance"ã€‚è‹¥æœ‰ï¼Œå¿…é ˆè¼¸å‡ºã€å›ºå®šèªå¥ Bã€‘æ®µè½ã€‚
   - æª¢æŸ¥åŸæ–‡æ˜¯å¦æåŠ "Avoid grapefruit" æˆ– "Sunlight sensitivity"ï¼Œå‹™å¿…åˆ—å…¥æ³¨æ„äº‹é …ã€‚

# Output Template (è«‹å¡«å…¥ä»¥ä¸‹æ ¼å¼)

[å­¸å]ï¼š ${generic}
[å•†å“å]ï¼š ${brand}
[ç”¨é€”]ï¼š (è«‹æ ¹æ“šä¾†æºæ–‡ä»¶ç¿»è­¯é©æ‡‰ç—‡)

[ä½¿ç”¨æ–¹æ³•]ï¼š
(è«‹æ ¹æ“šä¾†æºæ–‡ä»¶ç¿»è­¯ç”¨æ³•ï¼ŒåŒ…å«æ˜¯å¦éœ€éš¨é¤æœç”¨)
å¯¦éš›ç”¨æ³•ç”¨é‡è«‹éµé†«å›‘ä½¿ç”¨ã€‚

[å¿˜äº†ç”¨è—¥æ€éº¼è¾¦ï¼Ÿ]
(è«‹æ ¹æ“šä¾†æºæ–‡ä»¶ "Missed Dose" å€å¡Šç¿»è­¯)

[æ³¨æ„äº‹é …]ï¼š
ã€å›ºå®šèªå¥ Aã€‘
è‹¥æ‚¨æœ‰ä¸‹åˆ—ç‹€æ³ï¼Œä¸å¯ä½¿ç”¨æœ¬è—¥ï¼š(åˆ—å‡º Contraindicationsï¼Œå¦‚éæ•ã€ç‰¹å®šç—…å²)

è‹¥æœ‰ä¸‹åˆ—æƒ…æ³ï¼Œè«‹ç¢ºèªå·²å…ˆå‘ŠçŸ¥æ‚¨çš„é†«å¸«ï¸°(åˆ—å‡º Precautionsï¼Œå¦‚æ‡·å­•ã€å“ºä¹³ã€å…¶ä»–ç–¾ç—…)

æœ¬è—¥è³¦å‹åŠ‘è³‡è¨Šï¼š(è‹¥ä¾†æºæœªæåŠå¯ç•™ç©ºæˆ–å¯«ç„¡ç‰¹æ®Šè¨»è¨˜)

ã€å›ºå®šèªå¥ - äº¤äº’ä½œç”¨ã€‘
è«‹æ‚¨å°‡ç›®å‰ä½¿ç”¨çš„è—¥å“ï¼ˆåŒ…æ‹¬å¸‚å”®æˆè—¥ã€å„é¡ç‡Ÿé¤Šé£Ÿå“ä»¥åŠä¸­è‰è—¥ç­‰ï¼‰å‘ŠçŸ¥é†«å¸«ã€‚å°¤å…¶æ˜¯(åˆ—å‡º Drug Interactions è—¥ç‰©é¡åˆ¥)ç­‰è—¥å“ã€‚é€™äº›è—¥ç‰©èˆ‡æœ¬è—¥ä½µç”¨æœƒäº’ç›¸å½±éŸ¿ç™‚æ•ˆæˆ–å¢åŠ å‰¯ä½œç”¨çš„åš´é‡åº¦ï¼Œè«‹å‹™å¿…å…ˆå‘ŠçŸ¥é†«å¸«ï¼Œè®“é†«å¸«ç¢ºèªè—¥å“å¦‚ä½•é–‹ç«‹ã€‚

(è‹¥ä¾†æºæåŠå½±éŸ¿å°ˆæ³¨åŠ›/é ­æšˆ/è¦–åŠ›ï¼Œè«‹å¡«å¯«ä¸‹æ–¹ï¼Œå¦å‰‡çœç•¥)
ã€å›ºå®šèªå¥ Bã€‘
æœ¬è—¥å¯èƒ½æœƒå¼•èµ·(å¡«å…¥ç—‡ç‹€ï¼šå¦‚é ­æšˆã€è¦–åŠ›æ¨¡ç³Š)ï¼Œåœ¨ä¸ç¢ºå®šæœ¬è—¥å°æ‚¨é€ æˆçš„å½±éŸ¿å‰ï¼Œè«‹é¿å…å¾äº‹éœ€å°ˆæ³¨åŠ›åŠå”èª¿åŠ›çš„æ´»å‹•ï¼Œä¾‹å¦‚é–‹è»Šæˆ–æ“ä½œå±éšªå™¨æ¢°ã€‚

(è‹¥ä¾†æºæåŠéœ€å®šæœŸæª¢æŸ¥ï¼Œè«‹å¡«å¯«ä¸‹æ–¹ï¼Œå¦å‰‡çœç•¥)
ã€å›ºå®šèªå¥ Cã€‘
ä½¿ç”¨æœ¬è—¥æ²»ç™‚æœŸé–“ï¼Œé†«å¸«æœƒå¹«æ‚¨å®‰æ’å®šæœŸæª¢æŸ¥ï¼Œå¦‚ï¸°(å¡«å…¥æª¢æŸ¥é …ç›®ï¼šå¦‚è‚åŠŸèƒ½ã€ç”²ç‹€è…ºã€çœ¼ç›æª¢æŸ¥)ç­‰ï¼Œè«‹å‹™å¿…åœ¨é†«å¸«ç‚ºæ‚¨å®‰æ’çš„æ™‚é–“æ¥å—æª¢æŸ¥ã€‚

[å¯èƒ½çš„å‰¯ä½œç”¨]ï¼š
å‰¯ä½œç”¨ä¸ä¸€å®šæœƒç™¼ç”Ÿï¼Œä½†ä»æé†’æ‚¨æ³¨æ„ï¸°

ã€å›ºå®šèªå¥ Dã€‘
ä¸‹åˆ—ç‚ºè¼ƒå¸¸ç™¼ç”Ÿä½†è¼ƒä¸åš´é‡çš„å‰¯ä½œç”¨ï¼Œè‹¥ç™¼ç”Ÿï¼Œè«‹æ–¼å›è¨ºæ™‚å‘ŠçŸ¥é†«å¸«ï¼›ä½†è‹¥ç—‡ç‹€æŒçºŒã€åŠ é‡ï¼Œæˆ–å·²é€ æˆæ‚¨çš„å›°æ“¾ï¼Œè«‹æå‰å›è¨ºå‘ŠçŸ¥é†«å¸«ï¼š
(åˆ—å‡º Common Side Effects)

ã€å›ºå®šèªå¥ Eã€‘
è‹¥æ‚¨æ–¼æœè—¥æœŸé–“ï¼Œç™¼ç”Ÿä¸‹åˆ—ç½•è¦‹ä½†è¼ƒåš´é‡çš„å‰¯ä½œç”¨ï¼Œè«‹ç›¡å¿«å°±é†«ï¼š
(åˆ—å‡º Serious/Warning Side Effects)

ã€å›ºå®šèªå¥ Fã€‘
å¦‚æœæ‚¨ç™¼ç¾ä¸Šè¿°æœªæåŠä¹‹å‰¯ä½œç”¨ï¼Œä¸”èªç‚ºå¯èƒ½æ˜¯æœ¬è—¥æ‰€é€ æˆï¼Œè«‹æ–¼å›è¨ºæ™‚å‘ŠçŸ¥é†«å¸«ã€‚

[ä¿å­˜æ–¹æ³•]ï¼š
(æ ¹æ“š Storage ç¿»è­¯ï¼Œå¦‚å®¤æº«ã€é¿å…‰)

ã€å›ºå®šèªå¥ Gã€‘
è«‹å°‡è—¥å“æ”¾ç½®æ–¼å…’ç«¥ç„¡æ³•è§¸åŠè™•ï¼Œä»¥å…é€ æˆèª¤æœã€‚
è«‹å‹¿å°‡è—¥å“æä¾›çµ¦ä»–äººä½¿ç”¨ã€‚
è«‹æ–¼é†«å›‘æ²»ç™‚æœŸé–“ä½¿ç”¨è—¥å“ï¼Œå‹¿ä½¿ç”¨éæœŸè—¥å“ã€‚

${disposalInstruction}
`;

        document.getElementById('outputPreview').textContent = prompt;
        
        navigator.clipboard.writeText(prompt).then(() => {
            alert("Prompt å·²ç”Ÿæˆä¸¦è¤‡è£½ï¼è«‹è²¼ä¸Šè‡³ AI (ChatGPT/Gemini) é€²è¡Œç”Ÿæˆã€‚");
        }).catch(err => {
            alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä¸‹æ–¹é è¦½æ–‡å­—ã€‚");
        });
    }
</script>

</body>
</html>
